<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>HeatmapGL - ECHARTS-GL</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, user-scalable=no"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <!-- Fullscreen Landscape on iOS -->
    <link rel="stylesheet" href="./common.css" />
    <style>
      .wrapper {
        position: relative;
        height: 50vh;
      }
    </style>
  </head>
  <body>
    <div class="wrapper">
      <div id="main"></div>
    </div>
    <script src="../node_modules/echarts/dist/echarts.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts@4.9.0/map/js/china.js"></script>
    <script src="../dist/echarts-gl.js"></script>
    <script src="lib/jquery.min.js"></script>
    <script src="js/commonUI.js"></script>
    <script>
      const main = document.getElementById("main");

      //──── Full screen ───────────────────────────────────────────────────────────────────────

      const toggleFullScreen = () => {
        console.log("toggle full screen");
        const isDocInFullScreenMode =
          document.fullscreenElement ||
          document["mozFullScreenElement"] ||
          document["webkitFullscreenElement"] ||
          document["msFullscreenElement"];

        if (isDocInFullScreenMode) {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          } else if (document["webkitExitFullscreen"]) {
            /* Safari */
            document["webkitExitFullscreen"]();
          } else if (document["msExitFullscreen"]) {
            /* IE11 */
            document["msExitFullscreen"]();
          }
        } else {
          const target = main;
          if (target.requestFullscreen) {
            target.requestFullscreen();
          } else if (target["webkitRequestFullscreen"]) {
            /* Safari */
            target["webkitRequestFullscreen"]();
          } else if (target["msRequestFullscreen"]) {
            /* IE11 */
            target["msRequestFullscreen"]();
          }
        }
      };

      //──── Save as image ─────────────────────────────────────────────────────────────────────
      const onSaveAsImage = (document, imgSrc, name) => {
        const link = document.createElement("a");
        // link.setAttribute("src", imgSrc);
        link.setAttribute("target", "_blank");
        link.setAttribute("href", `${imgSrc}`);
        link.setAttribute("download", `${name}.png`);
        link.style.display = "none";
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
      };
      const saveAsImageConfig = {
        name: "COTU_ST_WL_OG215_LEVEL",
        show: false,
        icon: "M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",
        title: "save as image",
      };

      const onclickSaveBtn = () => {
        const chartBase64 = chart.getDataURL({
          excludeComponents: ["toolbox", "dataZoom"],
        });
        const chartImg = new Image();
        chartImg.src = chartBase64;

        // const glCanvas = document.getElementsByTagName("canvas")[1];
        // const glBase64 = glCanvas.toDataURL();
        // const glImg = new Image();
        // glImg.src = glBase64;

        const width = chart.getWidth();
        const height = chart.getHeight();
        const canvas = document.createElement("canvas");
        canvas.height = height;
        canvas.width = width;
        const ctx = canvas.getContext("2d");

        // const img = new Image();
        // img.src = imgBase64;
        chartImg.onload = function () {
          ctx.drawImage(chartImg, 0, 0, width, height);
          // ctx.drawImage(glImg, 0, 0, width, height);
          // ctx.font = "bold 20px Arial";
          // ctx.textAlign = "center";
          // ctx.fillStyle = "#808080";
          // ctx.fillText("Chart title", width / 2, 20);
          const dataURL = canvas.toDataURL();
          onSaveAsImage(document, dataURL, "fila name");
        };
      };

      var chart = echarts.init(document.getElementById("main"));

      //──── resize observer ───────────────────────────────────────────────────────────────────
      const resizeObserver = new ResizeObserver(() => {
        console.log("resize");
        chart.resize();
      });

      resizeObserver.observe(main);

      chart.setOption({
        backgroundColor: "#fff",
        tooltip: {
          trigger: "item",
          formatter: "{c} C",
        },
        legend: {
          show: true,
          x: -5,
          formatter: "{name}",
          top: -5,
        },
        toolbox: {
          feature: {
            dataZoom: {
              title: {
                zoom: "zoom",
                back: "back",
              },
              yAxisIndex: "none",
            },
            saveAsImage: {
              name: "COTU_ST_WL_OG215_LEVEL",
              show: false,
              icon: "M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",
              title: "save as image",
            },
            mySaveAsImage: {
              name: "COTU_ST_WL_OG215_LEVEL",
              show: true,
              icon: "M4.7,22.9L29.3,45.5L54.7,23.4M4.6,43.6L4.6,58L53.8,58L53.8,43.6M29.2,45.1L29.2,0",
              title: "save as image",
              onclick: () => onclickSaveBtn(),
            },
            myFullscreen: {
              title: "fullscreen",
              icon: "M -7 -2 L -7 -7 M -7 -7 L -2 -7 M -7 2 L -7 7 M -2 7 L -7 7 M 2 7 L 7 7 M 7 2 L 7 7 M 7 -2 L 7 -7 M 2 -7 L 7 -7",
              show: true,
              onclick: () => toggleFullScreen(),
            },
          },
        },
        xAxis: {
          type: "category",
          min: "0%",
          max: "100%",
        },
        yAxis: {
          type: "category",
          name: "Y Axis name params",
          nameLocation: "center",
          nameGap: 30,
        },
        grid: {
          containLabel: true,
        },
        dataZoom: [
          {
            type: "inside",
            start: 0,
            end: 100,
          },
          {
            start: 0,
            end: 100,
            handleIcon:
              "M10.7,11.9v-1.3H9.3v1.3c-4.9,0.3-8.8,4.4-8.8,9.4c0,5,3.9,9.1,8.8,9.4v1.3h1.3v-1.3c4.9-0.3,8.8-4.4,8.8-9.4C19.5,16.3,15.6,12.2,10.7,11.9z M13.3,24.4H6.7V23h6.6V24.4z M13.3,19.6H6.7v-1.4h6.6V19.6z",
            handleSize: "80%",
            handleStyle: {
              color: "#fff",
              shadowBlur: 3,
              shadowColor: "rgba(0, 0, 0, 0.6)",
              shadowOffsetX: 2,
              shadowOffsetY: 2,
            },
          },
        ],
        series: [
          {
            name: "Punch Card",
            type: "heatmapGL",
            id: "serie-heat-1",
            label: {
              show: true,
            },
            emphasis: {
              itemStyle: {
                shadowBlur: 10,
                shadowColor: "rgba(0, 0, 0, 0.5)",
              },
            },
            data: [
              ["16th", "00", 9.738],
              ["16th", "01", 8.639],
              ["16th", "02", 3.696],
              ["16th", "03", 4.606],
              ["16th", "04", 6.307],
              ["16th", "05", 4.574],
              ["16th", "06", 6.49],
              ["16th", "07", 5.711],
              ["16th", "08", 1.909],
              ["16th", "09", 8.492],
              ["16th", "00", 2.402],
              ["17th", "00", 2.512],
              ["17th", "01", 5.593],
              ["17th", "02", 9.968],
              ["17th", "03", 9.345],
              ["17th", "04", 5.202],
              ["17th", "05", 1.651],
              ["17th", "06", 7.071],
              ["17th", "07", 6.872],
              ["17th", "08", 8.076],
              ["17th", "09", 3.001],
              ["17th", "10", 0.324],
              ["18th", "00", 7.789],
              ["18th", "01", 2.204],
              ["18th", "02", 2.732],
              ["18th", "03", 9.881],
              ["18th", "04", 6.862],
              ["18th", "05", 2.131],
              ["18th", "06", 2.567],
              ["18th", "07", 8.649],
              ["18th", "08", 2.673],
              ["18th", "09", 3.044],
              ["18th", "10", 4.831],
              ["19th", "00", 0.429],
              ["19th", "01", 3.743],
              ["19th", "02", 2.468],
              ["19th", "03", 7.813],
              ["19th", "04", 4.708],
              ["19th", "05", 3.187],
              ["19th", "06", 3.074],
              ["19th", "07", 1.31],
              ["19th", "08", 1.773],
              ["19th", "09", 0.002],
              ["19th", "10", 1.834],
              ["20th", "00", 8.465],
              ["20th", "01", 3.662],
              ["20th", "02", 7.413],
              ["20th", "03", 6.825],
              ["20th", "04", 3.577],
              ["20th", "05", 2.93],
              ["20th", "06", 6.646],
              ["20th", "07", 1.759],
              ["20th", "08", 3.53],
              ["20th", "09", 2.581],
              ["20th", "10", 9.241],
              ["21st", "00", 8.461],
              ["21st", "01", 2.2],
              ["21st", "02", 2.175],
              ["21st", "03", 7.929],
              ["21st", "04", 0.994],
              ["21st", "05", 0.501],
              ["21st", "06", 5.556],
              ["21st", "07", 9.974],
              ["21st", "08", 2.817],
              ["21st", "09", 0.678],
              ["21st", "10", 2.126],
              ["22nd", "00", 4.434],
              ["22nd", "01", 1.507],
              ["22nd", "02", 8.343],
              ["22nd", "03", 8.895],
              ["22nd", "04", 3.094],
              ["22nd", "05", 5.824],
              ["22nd", "06", 0.854],
              ["22nd", "07", 7.372],
              ["22nd", "08", 5.898],
              ["22nd", "09", 2.691],
              ["22nd", "10", 0.847],
              ["23rd", "00", 2.683],
              ["23rd", "01", 8.225],
              ["23rd", "02", 5.123],
              ["23rd", "03", 1.454],
              ["23rd", "04", 6.975],
              ["23rd", "05", 5.937],
              ["23rd", "06", 2.966],
              ["23rd", "07", 0.879],
              ["23rd", "08", 9.732],
              ["23rd", "09", 2.39],
              ["23rd", "10", 1.886],
              ["24th", "00", 1.344],
              ["24th", "01", 2.934],
              ["24th", "02", 7.079],
              ["24th", "03", 7.779],
              ["24th", "04", 9.578],
              ["24th", "05", 6.551],
              ["24th", "06", 7.855],
              ["24th", "07", 2.679],
              ["24th", "08", 8.955],
              ["24th", "09", 6.323],
              ["24th", "10", 9.313],
              ["25th", "00", 2.077],
              ["25th", "01", 4.264],
              ["25th", "02", 3.364],
              ["25th", "03", 1.141],
              ["25th", "04", 8.967],
              ["25th", "05", 2.869],
              ["25th", "06", 3.542],
              ["25th", "07", 9.667],
              ["25th", "08", 3.596],
              ["25th", "09", 2.916],
              ["25th", "10", 3.954],
              ["26th", "00", 9.19],
              ["26th", "01", 6.133],
              ["26th", "02", 7.42],
              ["26th", "03", 8.96],
              ["26th", "04", 7.137],
              ["26th", "05", 0.489],
              ["26th", "06", 2.229],
              ["26th", "07", 3],
              ["26th", "08", 5.977],
              ["26th", "09", 6.759],
              ["26th", "10", 1.231],
              ["27th", "00", 9.778],
              ["27th", "01", 8.321],
              ["27th", "02", 0.963],
              ["27th", "03", 5.271],
              ["27th", "04", 9.685],
              ["27th", "05", 5.35],
              ["27th", "06", 4.672],
              ["27th", "07", 4.577],
              ["27th", "08", 0.824],
              ["27th", "09", 4.115],
              ["27th", "10", 5.328],
              ["28th", "00", 4.692],
              ["28th", "01", 0.053],
              ["28th", "02", 1.863],
              ["28th", "03", 3.086],
              ["28th", "04", 4.835],
              ["28th", "05", 4.431],
              ["28th", "06", 2.753],
              ["28th", "07", 2.051],
              ["28th", "08", 2.651],
              ["28th", "09", 8.313],
              ["28th", "10", 0.956],
              ["29th", "00", 2.919],
              ["29th", "01", 6.697],
              ["29th", "02", 8.626],
              ["29th", "03", 2.579],
              ["29th", "04", 9.171],
              ["29th", "05", 6.115],
              ["29th", "06", 5.099],
              ["29th", "07", 1.736],
              ["29th", "08", 5.535],
              ["29th", "09", 8.234],
              ["29th", "10", 6.036],
              ["30th", "00", 1.423],
              ["30th", "01", 9.564],
              ["30th", "02", 9.747],
              ["30th", "03", 3.302],
              ["30th", "04", 0.653],
              ["30th", "05", 5.433],
              ["30th", "06", 4.281],
              ["30th", "07", 3.075],
              ["30th", "08", 4.507],
              ["30th", "09", 3.151],
              ["30th", "10", 3.887],
              ["31st", "00", 0.094],
              ["31st", "01", 1.262],
              ["31st", "02", 1.63],
              ["31st", "03", 7.938],
              ["31st", "04", 5.227],
              ["31st", "05", 8.301],
              ["31st", "06", 3.172],
              ["31st", "07", 8.675],
              ["31st", "08", 7.15],
              ["31st", "09", 2.874],
              ["31st", "10", 7.241],
              ["1st", "00", 3.504],
              ["1st", "01", 7.393],
              ["1st", "02", 0.643],
              ["1st", "03", 5.895],
              ["1st", "04", 1.959],
              ["1st", "05", 4.442],
              ["1st", "06", 5.732],
              ["1st", "07", 4.923],
              ["1st", "08", 8.712],
              ["1st", "09", 9.592],
              ["1st", "10", 8.515],
              ["2nd", "00", 0.445],
              ["2nd", "01", 5.603],
              ["2nd", "02", 5.166],
              ["2nd", "03", 7.068],
              ["2nd", "04", 3.809],
              ["2nd", "05", 0.491],
              ["2nd", "06", 0.887],
              ["2nd", "07", 2.563],
              ["2nd", "08", 3.347],
              ["2nd", "09", 6.588],
              ["2nd", "10", 8.653],
              ["3rd", "00", 9.834],
              ["3rd", "01", 5.114],
              ["3rd", "02", 1.382],
              ["3rd", "03", 6.581],
              ["3rd", "04", 8.965],
              ["3rd", "05", 7.402],
              ["3rd", "06", 3.791],
              ["3rd", "07", 6.061],
              ["3rd", "08", 8.404],
              ["3rd", "09", 3.955],
              ["3rd", "10", 2.297],
              ["4th", "00", 5.101],
              ["4th", "01", 8.137],
              ["4th", "02", 2.216],
              ["4th", "03", 5.13],
              ["4th", "04", 9.366],
              ["4th", "05", 2.743],
              ["4th", "06", 8.354],
              ["4th", "07", 6.946],
              ["4th", "08", 8.085],
              ["4th", "09", 2.695],
              ["4th", "10", 5.629],
              ["5th", "00", 8.534],
              ["5th", "01", 8.13],
              ["5th", "02", 0.936],
              ["5th", "03", 9.355],
              ["5th", "04", 4.499],
              ["5th", "05", 0.781],
              ["5th", "06", 3.59],
              ["5th", "07", 3.15],
              ["5th", "08", 4.466],
              ["5th", "09", 2.943],
              ["5th", "10", 7.797],
              ["6th", "00", 7.725],
              ["6th", "01", 8.275],
              ["6th", "02", 1.69],
              ["6th", "03", 2.552],
              ["6th", "04", 5.502],
              ["6th", "05", 4.904],
              ["6th", "06", 8.109],
              ["6th", "07", 1.77],
              ["6th", "08", 0.438],
              ["6th", "09", 8.528],
              ["6th", "10", 3.041],
              ["7th", "00", 3.34],
              ["7th", "01", 3.308],
              ["7th", "02", 7.432],
              ["7th", "03", 2.48],
              ["7th", "04", 8.649],
              ["7th", "05", 5.554],
              ["7th", "06", 3.126],
              ["7th", "07", 6.578],
              ["7th", "08", 6.623],
              ["7th", "09", 6.991],
              ["7th", "10", 5.504],
              ["8th", "00", 0.579],
              ["8th", "01", 3.688],
              ["8th", "02", 0.829],
              ["8th", "03", 6.178],
              ["8th", "04", 8.228],
              ["8th", "05", 6.254],
              ["8th", "06", 0.415],
              ["8th", "07", 8.14],
              ["8th", "08", 6.206],
              ["8th", "09", 2.665],
              ["8th", "10", 9.805],
              ["9th", "00", 9.978],
              ["9th", "01", 9.778],
              ["9th", "02", 2.018],
              ["9th", "03", 2.532],
              ["9th", "04", 9.984],
              ["9th", "05", 7.751],
              ["9th", "06", 3.83],
              ["9th", "07", 0.349],
              ["9th", "08", 1.072],
              ["9th", "09", 7.929],
              ["9th", "10", 6.243],
              ["10th", "00", 7.368],
              ["10th", "01", 9.036],
              ["10th", "02", 8.431],
              ["10th", "03", 9.038],
              ["10th", "04", 4.544],
              ["10th", "05", 9.571],
              ["10th", "06", 5.116],
              ["10th", "07", 5.307],
              ["10th", "08", 4.778],
              ["10th", "09", 9.571],
              ["10th", "10", 9.786],
              ["11th", "00", 0.167],
              ["11th", "01", 5.124],
              ["11th", "02", 3.176],
              ["11th", "03", 6.403],
              ["11th", "04", 9.566],
              ["11th", "05", 2.985],
              ["11th", "06", 5.018],
              ["11th", "07", 7.76],
              ["11th", "08", 1.374],
              ["11th", "09", 2.237],
              ["11th", "10", 7.325],
              ["12th", "00", 6.229],
              ["12th", "01", 5.156],
              ["12th", "02", 0.794],
              ["12th", "03", 3.115],
              ["12th", "04", 9.009],
              ["12th", "05", 1.824],
              ["12th", "06", 4.66],
              ["12th", "07", 7.941],
              ["12th", "08", 3.022],
              ["12th", "09", 1.939],
              ["12th", "10", 5.991],
              ["13th", "00", 0.161],
              ["13th", "01", 7.981],
              ["13th", "02", 7.112],
              ["13th", "03", 9.055],
              ["13th", "04", 4.026],
              ["13th", "05", 4.97],
              ["13th", "06", 7.176],
              ["13th", "07", 6.662],
              ["13th", "08", 0.809],
              ["13th", "09", 5.789],
              ["13th", "10", 2.703],
              ["14th", "00", 1.533],
              ["14th", "01", 3.255],
              ["14th", "02", 8.18],
              ["14th", "03", 5.818],
              ["14th", "04", 4.051],
              ["14th", "05", 0.546],
              ["14th", "06", 4.392],
              ["14th", "07", 0.279],
              ["14th", "08", 2.086],
              ["14th", "09", 4.862],
              ["14th", "10", 4.047],
            ],
          },
        ],
        visualMap: {
          min: 0,
          max: 10,
          calculable: true,
          orient: "vertical",
          right: "2%",
          top: "5%",
        },
        title: {
          text: "No Data",
          show: false,
        },
      });
    </script>
    <script>
      document.addEventListener("click", (e) => {
        console.log("%cClick", "color: darkred", { x: e?.zrX, y: e?.zrY });
      });
    </script>
  </body>
</html>
